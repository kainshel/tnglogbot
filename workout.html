<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <link rel="manifest" href="manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ‚Äî –î–Ω–µ–≤–Ω–∏–∫ –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/components/buttons.css">
  <link rel="stylesheet" href="styles/components/cards.css">
  <link rel="stylesheet" href="styles/components/navigation.css">
  <link rel="stylesheet" href="styles/components/modals.css">
  <link rel="stylesheet" href="styles/components/forms.css">
  <link rel="stylesheet" href="styles/pages/workout.css">
  
  <script src="scripts/modules/workout/app_workout.js" defer></script>
  <script src="tg-init.js" defer></script>
  <script src="nav.js" defer></script>
</head>
<body>
  <!-- –ö–Ω–æ–ø–∫–∞ –±—É—Ä–≥–µ—Ä-–º–µ–Ω—é -->
  <button id="burger" class="burger" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é" aria-controls="sidebar" aria-expanded="false">
    <span></span><span></span><span></span>
  </button>
  <div id="backdrop" class="backdrop" hidden></div>

  <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
  <aside id="sidebar" class="sidebar">
    <div class="brand">–î–Ω–µ–≤–Ω–∏–∫ –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
    <nav role="navigation" aria-label="Main" class="nav">
      <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="exercises.html">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</a>
      <a class="active" href="workout.html">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</a>
      <a href="history.html">–ò—Å—Ç–æ—Ä–∏—è</a>
      <a href="profile.html">–ü—Ä–æ—Ñ–∏–ª—å</a>
    </nav>
  </aside>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
  <main class="content">
    <header class="page-header">
      <h1>–ü–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h1>
      <div class="header-actions">
        <button class="btn secondary" onclick="workoutState.reset()" title="–û—á–∏—Å—Ç–∏—Ç—å –ø–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏">
          üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
        </button>
      </div>
    </header>

    <!-- –í—ã–±–æ—Ä –¥–∞—Ç—ã -->
    <section class="card date-section">
      <div class="date-input-group">
        <label for="date" class="date-label">
          <strong>üìÖ –î–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:</strong>
        </label>
        <input type="date" id="date" class="date-picker">
      </div>
    </section>

    <!-- –°–æ—Å—Ç–∞–≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
    <section class="card workout-plan-section">
      <div class="section-header">
        <h2>üèãÔ∏è –ú–æ—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h2>
        <div class="workout-stats" id="workoutStats">
          <span class="stat">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è: <strong>0</strong></span>
          <span class="stat">–ü–æ–¥—Ö–æ–¥—ã: <strong>0</strong></span>
        </div>
      </div>
      
      <div id="plan" class="plan-container"></div>
      
      <div class="plan-actions">
        <button id="saveBtn" class="btn primary save-btn">
          üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
        </button>
        <div class="secondary-actions">
          <button class="btn secondary" onclick="window.location.href='programs.html'">
            üìã –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É
          </button>
          <button class="btn outline" onclick="exportWorkoutPlan()">
            üì§ –≠–∫—Å–ø–æ—Ä—Ç
          </button>
        </div>
      </div>
    </section>

    <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
    <section class="card filters-section">
      <div class="section-header">
        <h2>üîç –ù–∞–π—Ç–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h2>
        <button class="btn text-btn" onclick="resetFilters()">
          –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
        </button>
      </div>
      
      <div class="filters-grid">
        <div class="search-group">
          <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." class="search-input">
        </div>
        
        <div class="filter-group">
          <label for="filter-groups">–ì—Ä—É–ø–ø–∞ –º—ã—à—Ü</label>
          <select id="filter-groups" class="filter-select">
            <option value="">–í—Å–µ –≥—Ä—É–ø–ø—ã</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="filter-targets">–¶–µ–ª–µ–≤–∞—è –∑–æ–Ω–∞</label>
          <select id="filter-targets" class="filter-select">
            <option value="">–í—Å–µ –∑–æ–Ω—ã</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="filter-type">–¢–∏–ø —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</label>
          <select id="filter-type" class="filter-select">
            <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="filter-equipment">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</label>
          <select id="filter-equipment" class="filter-select">
            <option value="">–õ—é–±–æ–µ</option>
          </select>
        </div>
      </div>
      
      <div class="active-filters" id="activeFilters"></div>
    </section>

    <!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è -->
    <section class="card exercises-section">
      <div class="section-header">
        <h2>üí™ –î–æ—Å—Ç—É–ø–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h2>
        <div class="exercises-count" id="exercisesCount">
          <span>–ù–∞–π–¥–µ–Ω–æ: <strong>0</strong></span>
        </div>
      </div>
      
      <div id="exercises-container" class="exercise-grid"></div>
      
      <div class="exercises-footer">
        <button class="btn text-btn" onclick="scrollToPlan()">
          ‚¨ÜÔ∏è –ö –ø–ª–∞–Ω—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        </button>
      </div>
    </section>
  </main>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è -->
  <div id="modalBack" class="modal-back" style="display: none;">
    <div id="modal" class="modal">
      <button id="modalClose" class="modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      <div id="modalContent" class="modal-content"></div>
    </div>
  </div>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div id="notifications" class="notifications-container"></div>

  <script>
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è HTML
    function resetFilters() {
      document.getElementById('search').value = '';
      document.getElementById('filter-groups').value = '';
      document.getElementById('filter-targets').value = '';
      document.getElementById('filter-type').value = '';
      document.getElementById('filter-equipment').value = '';
      
      // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
      if (typeof applyFilters === 'function') {
        applyFilters();
      }
    }
    
    function scrollToPlan() {
      const planSection = document.querySelector('.workout-plan-section');
      if (planSection) {
        planSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
    
    function exportWorkoutPlan() {
      if (workoutState.plan.length === 0) {
        alert('–ü–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø—É—Å—Ç!');
        return;
      }
      
      const workoutData = {
        date: document.getElementById('date').value,
        exercises: workoutState.plan.map(ex => ({
          name: ex.meta.name_ru || ex.meta.name_en,
          sets: ex.sets.length,
          completed: ex.sets.filter(set => set.weight && set.reps).length
        })),
        totalExercises: workoutState.plan.length,
        totalSets: workoutState.plan.reduce((sum, ex) => sum + ex.sets.length, 0)
      };
      
      const blob = new Blob([JSON.stringify(workoutData, null, 2)], { 
        type: 'application/json' 
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `workout-plan-${workoutData.date}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function updateWorkoutStats() {
      const statsElement = document.getElementById('workoutStats');
      if (statsElement) {
        statsElement.innerHTML = `
          <span class="stat">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è: <strong>${workoutState.plan.length}</strong></span>
          <span class="stat">–ü–æ–¥—Ö–æ–¥—ã: <strong>${workoutState.plan.reduce((sum, ex) => sum + ex.sets.length, 0)}</strong></span>
        `;
      }
    }
    
    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º renderPlan –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    const originalRenderPlan = renderPlan;
    renderPlan = function() {
      originalRenderPlan();
      updateWorkoutStats();
    };
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
      updateWorkoutStats();
    });
  </script>
</body>
</html>