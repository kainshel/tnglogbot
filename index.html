  <!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Главная</title>
<link rel="stylesheet" href="styles/main.css">
<link rel="stylesheet" href="styles/responsive.css">

<script src="nav.js" defer></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="tg-init.js" defer></script>
</head>
<body>
<title>Telegram Mini App</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; text-align: center; }
  button { padding: 10px 20px; font-size: 16px; margin: 10px; cursor: pointer; }
  .hidden { display: none; }
  #results { margin-top: 20px; }
</style>
<header class="topbar">
  <button id="burger" class="burger" aria-label="Открыть меню" aria-controls="sidebar" aria-expanded="false"><span></span><span></span><span></span></button>
  <h1 class="app-title">Дневник тренировок</h1>
  <div class="tg-userchip" aria-live="polite">
    <img id="tg-avatar" class="avatar" hidden>
    <span data-user-name></span>
  </div>
</header>
<div id="backdrop" class="backdrop" hidden></div>
<aside id="sidebar" class="sidebar" aria-hidden="true">
  <nav role="navigation" aria-label="Главное меню" class="nav">
  <a class="active" href="index.html">Главная</a>
  <a href="exercises.html">Упражнения</a>
  <a href="workout.html">Тренировка</a>
  <a href="history.html">История</a>
  <a href="profile.html">Профиль</a>
  </nav>
</aside>

<main class="main-content">

<h1>Добро пожаловать в наше мини-приложение!</h1>
<div id="login-block">
  <button id="login-btn">Войти через Telegram</button>
</div>

<div id="user-block" class="hidden">
  <h2>Привет, <span id="user-name"></span>!</h2>
  <button id="start-btn">Начать новый тест</button>
  <div id="results">
    <h3>История результатов:</h3>
    <ul id="results-list"></ul>
  </div>
</div>

<script>
  // Подключаем Telegram Web App
  const tg = window.Telegram.WebApp;

  const loginBtn = document.getElementById('login-btn');
  const loginBlock = document.getElementById('login-block');
  const userBlock = document.getElementById('user-block');
  const userNameEl = document.getElementById('user-name');
  const resultsList = document.getElementById('results-list');

  // Клик по кнопке "Войти через Telegram"
  loginBtn.addEventListener('click', () => {
    const user = tg.initDataUnsafe.user; // Получаем данные пользователя
    if (!user) {
      alert("Ошибка: не удалось получить данные пользователя Telegram.");
      return;
    }

    const userId = user.id;
    const fullName = `${user.first_name || ''} ${user.last_name || ''}`.trim();
    userNameEl.textContent = fullName;

    // Прячем блок входа, показываем блок пользователя
    loginBlock.classList.add('hidden');
    userBlock.classList.remove('hidden');

    // Загружаем результаты из локального хранилища (или с сервера)
    const results = JSON.parse(localStorage.getItem(`results_${userId}`)) || [];
    results.forEach(r => {
      const li = document.createElement('li');
      li.textContent = r;
      resultsList.appendChild(li);
    });

    // Кнопка "Начать тест"
    document.getElementById('start-btn').addEventListener('click', () => {
      const result = prompt("Введите результат теста:");
      if (result) {
        results.push(result);
        localStorage.setItem(`results_${userId}`, JSON.stringify(results));
        const li = document.createElement('li');
        li.textContent = result;
        resultsList.appendChild(li);
      }
    });
  });
</script>

</main>
</body>
</html>
